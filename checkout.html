<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - Gadrel Collection</title>
  <link rel="stylesheet" href="styles/styles.css" />
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background-color: #F8F8F8;
      color: #021D34;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background-color: #021D34;
      color: #FFFFFF;
      text-align: center;
      padding: 20px;
    }
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #D9AF6C;
    }
    nav {
      margin-top: 10px;
    }
    nav a {
      color: #F5E3C7;
      margin: 0 10px;
      text-decoration: none;
      font-weight: bold;
    }
    .dropdown {
      display: inline-block;
      position: relative;
    }
    .dropbtn {
      background: none;
      border: none;
      color: #F5E3C7;
      font-weight: bold;
      cursor: pointer;
    }
    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #FFFFFF;
      border: 1px solid #D9AF6C;
      min-width: 160px;
      z-index: 1;
    }
    .dropdown-content a {
      display: block;
      padding: 10px;
      color: #021D34;
      text-decoration: none;
    }
    .dropdown:hover .dropdown-content {
      display: block;
    }
    .featured {
      padding: 40px 20px;
      background-color: #F5E3C7;
      text-align: center;
      flex: 1;
    }
    .featured h2 {
      margin-bottom: 30px;
    }
    .checkout-box {
      background-color: #FFFFFF;
      padding: 20px;
      border: 1px solid #D9AF6C;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
      text-align: left;
    }
    .checkout-box h3 {
      margin-top: 0;
      color: #021D34;
    }
    .checkout-box input,
    .checkout-box textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      border: 1px solid #D9AF6C;
      background-color: #F8F8F8;
      color: #021D34;
    }
    .checkout-box button {
      background-color: #D9AF6C;
      color: #021D34;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
    }
    footer {
      background-color: #021D34;
      color: #FFFFFF;
      text-align: center;
      padding: 20px;
      margin-top: auto;
    }
    footer a {
      color: #D9AF6C;
      text-decoration: none;
      margin: 0 8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">GADREL COLLECTION</div>
    <nav>
      <a href="index.html">Home</a>
      <div class="dropdown">
        <button class="dropbtn">Shop</button>
        <div class="dropdown-content">
          <a href="shop.html">All Products</a>
          <a href="men.html">Men</a>
          <a href="women.html">Women</a>
          <a href="accessories.html">Accessories</a>
          <a href="bags.html">Bags</a>
          <a href="beauty.html">Beauty</a>
        </div>
      </div>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="cart.html">Cart ðŸ›’</a>
    </nav>
  </header>

  <section class="featured">
    <h2>Checkout</h2>
    <div class="checkout-box">
      <h3>Order Summary</h3>
      <div id="order-summary"></div>

      <label for="name">Full Name</label>
      <input type="text" id="name" placeholder="Enter your name" required />

      <label for="email">Email Address</label>
      <input type="email" id="email" placeholder="Enter your email" required />

      <label for="address">Shipping Address</label>
      <textarea id="address" rows="4" placeholder="Enter your address" required></textarea>

      <button onclick="payWithPaystack()">Pay Now</button>
    </div>
  </section>

  <footer>
    &copy; 2025 Gadrel Collection. All rights reserved.
    <br />
    <a href="https://instagram.com/gadrelcollection">Instagram</a> |
    <a href="mailto:support@gadrelcollection.com">Email Us</a> |
    <a href="https://wa.me/2348105429924">WhatsApp</a>
  </footer>

  <script>
    emailjs.init("your_userID"); // Replace with your EmailJS user ID

    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const summary = document.getElementById("order-summary");

    function renderSummary() {
      let total = 0;
      let html = "<ul>";
      cart.forEach(item => {
        total += item.price;
        html += `<li>${item.name} â€” â‚¦${item.price.toLocaleString()}</li>`;
      });
      html += "</ul>";
      html += `<strong>Total: â‚¦${total.toLocaleString()}</strong>`;
      summary.innerHTML = html;
    }

    function payWithPaystack() {
      const email = document.getElementById("email").value;
      const name = document.getElementById("name").value;
      const address = document.getElementById("address").value;
      const amount = cart.reduce((sum, item) => sum + item.price, 0) * 100;

      if (!email || !name || !address || cart.length === 0) {
        alert("Please fill all fields and ensure your cart is not empty.");
        return;
      }

      const ref = 'GC' + Math.floor(Math.random() * 1000000000);
      localStorage.setItem("lastRef", ref);

      const handler = PaystackPop.setup({
        key: 'pk_test_xxxxxxxxxxxxxxxxxxxxxxxx', // Replace with your Paystack public key
        email: email,
        amount: amount,
        currency: "NGN",
        ref: ref,
        metadata: {
          custom_fields: [
            { display_name: "Name", variable_name: "name", value: name },
            { display_name: "Address", variable_name: "address", value: address }
          ]
        },
        callback: function(response) {
          sendOrderEmail(name, email, address, cart, response.reference);
          localStorage.removeItem("cart");
          window.location.href = "thankyou.html";
        },
        onClose: function() {
          alert("Payment window closed.");
        }
      });
      handler.openIframe();
    }

    function sendOrderEmail(name, email, address, cart, reference) {
      const items = cart.map(item => `${item.name} - â‚¦${item.price.toLocaleString()}`).join("\n");
      const templateParams = {
        name: name,
        email: email,
        address: address,
        cart: items,
        reference: reference
      };

      emailjs.send("your_serviceID", "your_templateID", templateParams)
        .then(() => console.log("Order email sent"))
        .catch(err => console.error("Email error:", err));
    }

    renderSummary();
  </script>
</body>
</html>
